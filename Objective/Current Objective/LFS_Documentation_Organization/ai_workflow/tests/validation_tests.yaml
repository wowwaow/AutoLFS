# Validation Pipeline Tests
version: '1.0'

# Technical Content Tests
test_technical_content:
  command_syntax:
    test_valid_commands:
      input: |
        ./configure --prefix=/usr
        make -j$(nproc)
        make install
      expected: pass
    test_invalid_commands:
      input: |
        ./configure --invalid-flag
        make_invalid
      expected: fail
      error_message: "Invalid command syntax detected"

  version_compatibility:
    test_valid_version:
      input: "2.5.1"
      expected: pass
    test_invalid_version:
      input: "invalid.version"
      expected: fail
      error_message: "Invalid version format"

  dependency_chain:
    test_valid_chain:
      input:
        - "gcc >= 8.0.0"
        - "make >= 4.2"
      expected: pass
    test_circular_dependency:
      input:
        - "package-a >= 1.0.0"
        - "package-b >= 2.0.0 [requires: package-a]"
        - "package-a >= 1.0.0 [requires: package-b]"
      expected: fail
      error_message: "Circular dependency detected"

# Build Process Tests
test_build_process:
  build_commands:
    test_valid_build:
      input: |
        export CFLAGS="-O2"
        ./configure --prefix=/usr
        make
        make install
      expected: pass
    test_invalid_build:
      input: |
        export INVALID_FLAG="bad"
        ./configure --broken
      expected: fail
      error_message: "Invalid build configuration"

  environment_vars:
    test_valid_env:
      input:
        CC: gcc
        CFLAGS: "-O2"
      expected: pass
    test_invalid_env:
      input:
        INVALID_VAR: "bad value"
      expected: fail
      error_message: "Unknown environment variable"

# Security Check Tests
test_security_checks:
  security_best_practices:
    test_secure_permissions:
      input: |
        chmod 644 /etc/config
        chown root:root /usr/bin/program
      expected: pass
    test_insecure_permissions:
      input: |
        chmod 777 /etc/sensitive
      expected: fail
      error_message: "Insecure file permissions"

  permission_validation:
    test_valid_permissions:
      input:
        file: "/usr/bin/program"
        permissions: "755"
        owner: "root"
        group: "root"
      expected: pass
    test_invalid_permissions:
      input:
        file: "/etc/password"
        permissions: "666"
        owner: "nobody"
        group: "nobody"
      expected: fail
      error_message: "Invalid file permissions"

# Integration Tests
test_integration:
  full_validation_pipeline:
    test_complete_package:
      input: "test_fixtures.yaml#basic_package"
      stages:
        - technical_content
        - build_process
        - security_checks
      expected: pass
    test_invalid_package:
      input: "test_fixtures.yaml#invalid_package"
      stages:
        - technical_content
        - build_process
        - security_checks
      expected: fail
      error_messages:
        - "Invalid package configuration"
        - "Build process validation failed"
        - "Security checks failed"

