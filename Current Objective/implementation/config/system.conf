#!/bin/bash
# LFS Build Wrapper System - System Configuration
# Version: 1.0.0
# Created: 2025-05-31
# Description: System-wide default configuration

#######################################
# System Paths
#######################################

# Base directories
CONFIG[LFS_BASE]="/mnt/lfs"                              # LFS build root directory
CONFIG[BUILD_DIR]="/var/lib/lfs-wrapper/builds"          # Build workspace
CONFIG[LOG_DIR]="/var/log/lfs-wrapper"                   # Log directory
CONFIG[CACHE_DIR]="/var/cache/lfs-wrapper"               # Cache directory
CONFIG[BACKUP_DIR]="/var/backups/lfs-wrapper"            # Backup directory

# Script and tool paths
CONFIG[TOOLS_DIR]="${CONFIG[LFS_BASE]}/tools"           # Cross-compilation tools
CONFIG[SCRIPTS_DIR]="/opt/lfs-wrapper/scripts"          # Build scripts location
CONFIG[SOURCES_DIR]="${CONFIG[LFS_BASE]}/sources"       # Source package storage

#######################################
# Build Configuration
#######################################

# Resource limits
CONFIG[MAX_PARALLEL_BUILDS]=2                           # Maximum parallel builds
CONFIG[MAX_LOAD_AVERAGE]=4.0                           # Maximum system load
CONFIG[MIN_FREE_SPACE]=10240                           # Minimum free space (MB)
CONFIG[MAX_MEMORY_PERCENT]=80                          # Maximum memory usage (%)

# Build options
CONFIG[DEFAULT_CFLAGS]="-O2 -pipe"                     # Default CFLAGS
CONFIG[DEFAULT_CXXFLAGS]="-O2 -pipe"                   # Default CXXFLAGS
CONFIG[DEFAULT_MAKEFLAGS]="-j2"                        # Default make flags
CONFIG[ENABLE_TESTS]=true                              # Run package tests
CONFIG[SAVE_WORK]=false                                # Keep work directories

#######################################
# Logging Configuration
#######################################

# Log settings
CONFIG[LOG_LEVEL]="INFO"                               # Default log level
CONFIG[LOG_FORMAT]="standard"                          # Log format (standard/json)
CONFIG[LOG_RETENTION]=30                               # Days to keep logs
CONFIG[LOG_COMPRESSION]=true                           # Compress old logs

# Monitoring
CONFIG[ENABLE_MONITORING]=true                         # Enable system monitoring
CONFIG[MONITOR_INTERVAL]=300                           # Monitor interval (seconds)
CONFIG[ALERT_ON_ERROR]=true                           # Send alerts on errors

#######################################
# Security Settings
#######################################

# Permissions
CONFIG[BUILD_USER]="lfs"                               # Build user account
CONFIG[BUILD_GROUP]="lfs"                              # Build group
CONFIG[SUDO_COMMANDS]="mount,umount,chroot"            # Allowed sudo commands

# Verification
CONFIG[VERIFY_CHECKSUMS]=true                          # Verify package checksums
CONFIG[VERIFY_SIGNATURES]=true                         # Verify package signatures
CONFIG[ENFORCE_SECURITY]=true                          # Enforce security checks

#######################################
# Error Handling
#######################################

# Recovery options
CONFIG[AUTO_RECOVERY]=true                             # Enable auto recovery
CONFIG[MAX_RETRIES]=3                                  # Maximum retry attempts
CONFIG[BACKUP_ON_FAILURE]=true                         # Create backup on failure
CONFIG[CLEANUP_ON_FAILURE]=true                        # Clean failed builds

# Notification
CONFIG[NOTIFY_ON_COMPLETION]=true                      # Notify when done
CONFIG[NOTIFY_ON_ERROR]=true                           # Notify on errors
CONFIG[NOTIFICATION_METHOD]="log"                      # Notification method

#######################################
# System Integration
#######################################

# Dependencies
CONFIG[CHECK_DEPENDENCIES]=true                        # Check system dependencies
CONFIG[AUTO_INSTALL_DEPS]=false                        # Auto-install dependencies
CONFIG[DEPENDENCY_CHECK_INTERVAL]=86400                # Check interval (seconds)

# Environment
CONFIG[PRESERVE_ENV]=false                             # Preserve environment
CONFIG[REQUIRED_TOOLS]="gcc,make,patch,gawk,bison"    # Required system tools
CONFIG[PATH_ADDITIONS]="/opt/lfs-wrapper/bin"          # Path additions

